== SAGA Electronics Documentation

=== Functionality

STM32G441KBT6 microcontroller is the brain of the mainboard which is powered by 3.3V. There is a USB connector in the board which in one end connects to the on-board computer (NUC), and on the other end it is mounted to the mainboard PCB.  

The USB connector has 4-pins connected to the board, i.e., 5V power, GND, D+ and D-. D+ and D- lines are the differential communication lines and the 5V and the GND lines are the power common to the computer and the board with USB protection. 5V coming from this line is converted to 3.3V through the NCP164CSN voltage regulator and is feeded to the STM32's input.    

The STM32 microcontroller can be programmed through the programmer connector with a STLINK programmer module.       

The board is divided into two isolated parts, one for the low power operations like microcontroller communication with other peripherals like motor encoders, USB, etc. and the other dedicated for high power operations like interfacing with the high-power motor drivers and driving the motors, servo and thrower.     

The board is isolated into the parts using 2 MAX14930DASE+ 16-pin isolators and 1 MAX12930EASA+ 8-pin isolator.     

The motor driver section has 3 DRV8243HRXYQ1 motor drivers, one for each motor. The nSleep pin in the driver receives a signal from the microcontroller to enable the motor driving action, else the driver is in sleep mode. After receiving a wake up signal, microcontroller sends a direction and PWM signal to drive individual motors in desired direction.       

The high-power driving side also consists of a 5V TPS62933 voltage regulator converting input voltage ot 5V for isolators and servo motor.      

The board can control 3 brushed DC motors. The motor driver (DRV8243HRXYQ1) has input voltage of 16.8V coming from the battery.

Since ni ITRIP resistor is used, the voltage at ITRIP pin in 2.97 V. IPROPI is connected to 3.3k resistor. Therefore, the output current is given by:   +
output current = (2.97 V/3.3 kohms) * 3070 = 2.76 A.    +
Therefore, the output of the motor driver is 2.76 A.


=== Pinout Connections
   
==== Microcontroller pinout

===== USB
D+: PA11    +
D-: PA12    + 

===== Programmer
SWDIO: PA13 +
SWCLK: PA14 +   

===== Motor Encoders

====== Motor1 Encoder
Encoder A: PA0  +  
Encoder B: PA1  +

====== Motor2 Encoder
Encoder A: PA6  +
Encoder B: PA4  +

====== Motor3 Encoder
Encoder A: PA8  +
Encoder B: PA9  +

====== Thrower
Thrower PWM: PA2    +    

====== Servo
Servo PWM: PA15 +

====== Motor Drivers
nSleep : PA10 (common to all 3 drivers) +

Motor1 DIR: PB7   +
Motor1 PWM: PB8   +

Motor2 DIR: PB5   +
Motor2 PWM: PB6   +

Motor3 DIR: PB3   +
Motor3 PWM: PB4   +

==== PCB front side

image::electronics/Images/PCB_front.PNG[]

==== PCB back side

image::electronics/Images/PCB_back.PNG[]


==== Connector pinouts

===== J2 Programmer

1. 3.3V
2. SWDIO
3. GND
4. SWCLK
5. GND
6. NC
7. NC
8. NC
9. GND
10. NRST

===== Motor Encoder Connectors (J8, J9, J10)

1. GND
2. 3.3V
3. Encoder A
4. Encoder B

===== J6 Thrower Connector

1. GND
2. Thrower Signal
3. NC
4. NC

===== J3 Servo Connector
1. Servo PWM Signal
2. 5V
3. GND